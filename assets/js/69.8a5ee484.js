(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{455:function(t,e,s){"use strict";s.r(e);var a=s(6),n=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"configuration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration","aria-hidden":"true"}},[t._v("#")]),t._v(" Configuration")]),t._v(" "),s("p",[t._v("Configuration is a "),s("strong",[t._v("required step")]),t._v(" before the application can be served by an ASGI server such as uvicorn.")]),t._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",[t._v("Except for "),s("a",{attrs:{href:"#retrieving-settings"}},[t._v("Retrieving settings")]),t._v(", you can safely ignore this section if you generated your project using the "),s("a",{attrs:{href:"https://github.com/bocadilloproject/bocadillo-cli",target:"_blank",rel:"noopener noreferrer"}},[t._v("Bocadillo CLI"),s("OutboundLink")],1),t._v(", which should have set up a "),s("a",{attrs:{href:"#settings-module"}},[t._v("settings module")]),t._v(" and a "),s("a",{attrs:{href:"#server-entry-point"}},[t._v("server entry point")]),t._v(" for you.")])]),t._v(" "),s("h2",{attrs:{id:"configuring-applications"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuring-applications","aria-hidden":"true"}},[t._v("#")]),t._v(" Configuring applications")]),t._v(" "),s("p",[t._v("Configuration occurs when the "),s("code",[t._v("configure()")]),t._v(" helper is called with the "),s("code",[t._v("app")]),t._v(" that should be served. This has the effect of calling all registered "),s("router-link",{attrs:{to:"/guide/plugins.html"}},[t._v("plugins")]),t._v(", which in turn set up features such as CORS, HTTPS redirection, etc.")],1),t._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),s("p",[t._v("Since it prepares the "),s("code",[t._v("app")]),t._v(" for serving, "),s("code",[t._v("configure()")]),t._v(" can only be called once.")])]),t._v(" "),s("p",[t._v("Besides the mandatory "),s("code",[t._v("app")]),t._v(" argument, "),s("code",[t._v("configure()")]),t._v(" can be given one or both of the following:")]),t._v(" "),s("ul",[s("li",[t._v("A settings object or module, e.g. "),s("code",[t._v("configure(app, settings)")]),t._v(". In this case, individual settings are obtained from upper-cased constants, e.g. "),s("code",[t._v('ALLOWED_HOSTS = ["example.com"]')]),t._v(".")])]),t._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",[t._v("You can prevent Bocadillo from treating intermediary variables as settings by prefixing them with a leading underscore, e.g. "),s("code",[t._v("_some_var")]),t._v(" or "),s("code",[t._v("_SOME_VAR")]),t._v(".")])]),t._v(" "),s("ul",[s("li",[t._v("Arbitrary settings passed as keyword arguments, e.g. "),s("code",[t._v('configure(app, ALLOWED_HOSTS=["example.com"])')]),t._v(".")])]),t._v(" "),s("h2",{attrs:{id:"retrieving-settings"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#retrieving-settings","aria-hidden":"true"}},[t._v("#")]),t._v(" Retrieving settings")]),t._v(" "),s("p",[t._v("If you ever need to access settings at runtime, you can use the "),s("code",[t._v("settings")]),t._v(" object.")]),t._v(" "),s("p",[t._v("This object can be imported from the "),s("code",[t._v("bocadillo")]),t._v(" package, and gets populated once "),s("code",[t._v("configure()")]),t._v(" is called (which has a few gotchas — see warning below). Besides regular dot notation, you can use the dict-like "),s("code",[t._v(".get()")]),t._v(" method to retrieve a setting with an optional default value.")]),t._v(" "),s("div",{staticClass:"warning custom-block"},[s("p",[t._v("Accessing an attribute of "),s("code",[t._v("settings")]),t._v(" before "),s("code",[t._v("configure()")]),t._v(" was called will raise an error.")]),t._v(" "),s("p",[t._v("For this reason, you should only access settings "),s("strong",[t._v("inside a function or a method")]),t._v(". In other words, you should not access settings at the top level of a Python module.")])]),t._v(" "),s("p",[t._v("Here is an example:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# myproject/app.py")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" bocadillo "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" settings\n\napp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n@app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" settings"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PUBLIC"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, world!"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Coming soon!"')]),t._v("\n")])])]),s("p",[t._v("Accessing settings is typically needed when implementing "),s("router-link",{attrs:{to:"/guide/plugins.html"}},[t._v("plugins")]),t._v(".")],1),t._v(" "),s("h2",{attrs:{id:"settings-module"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#settings-module","aria-hidden":"true"}},[t._v("#")]),t._v(" Settings module")]),t._v(" "),s("p",[t._v("The recommended way to define configuration is through a "),s("strong",[t._v("settings module")]),t._v(", i.e. a "),s("code",[t._v(".py")]),t._v(" file which declares settings as upper-cased constants.")]),t._v(" "),s("p",[t._v("We recommend you use Starlette's "),s("a",{attrs:{href:"https://www.starlette.io/config/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Config helper"),s("OutboundLink")],1),t._v(" to define settings. It reads configuration from environment variables and also supports "),s("code",[t._v(".env")]),t._v(" files located at the project root directory. This way, you only need "),s("strong",[t._v("one settings module")]),t._v(" for all environments (production, local development, etc.).")]),t._v(" "),s("p",[t._v("Here's an example:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# myproject/settings.py")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" starlette"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Config\n\nconfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('".env"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nALLOWED_HOSTS "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"example.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nHSTS "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HSTS"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("And the corresponding "),s("code",[t._v("app.py")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# myproject/app.py")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" bocadillo "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" configure\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" settings\n\napp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconfigure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" settings"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"warning custom-block"},[s("p",[t._v("The "),s("code",[t._v("from . import settings")]),t._v(" statement above is a "),s("strong",[t._v("relative import")]),t._v(". It only works if the code is located inside a "),s("strong",[t._v("package")]),t._v(" — here, "),s("code",[t._v("myproject")]),t._v(". If you don't use a package, you will need to use absolute imports, e.g. "),s("code",[t._v("import settings")]),t._v(".")]),t._v(" "),s("p",[t._v("For more information on Python imports, see "),s("a",{attrs:{href:"https://realpython.com/absolute-vs-relative-python-imports/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Absolute vs Relative Imports In Python"),s("OutboundLink")],1),t._v(" (Real Python).")])]),t._v(" "),s("h2",{attrs:{id:"server-entry-point"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#server-entry-point","aria-hidden":"true"}},[t._v("#")]),t._v(" Server entry point")]),t._v(" "),s("p",[t._v("Although the "),s("router-link",{attrs:{to:"/guide/apps.html#minimal-working-app"}},[t._v("minimal working app")]),t._v(" instanciates and configures the "),s("code",[t._v("app")]),t._v(" within the same script, it is recommended to perform these operations separately. This allows you to change settings at runtime, and encourages more decoupling between settings and applications.")],1),t._v(" "),s("p",[t._v("To achieve this, you should create a "),s("strong",[t._v("server entry point")]),t._v(", i.e. a Python script typically named "),s("code",[t._v("asgi.py")]),t._v(" where "),s("code",[t._v("configure()")]),t._v(" is called to prepare the "),s("code",[t._v("app")]),t._v(" before it is served by the ASGI server.")]),t._v(" "),s("p",[t._v("For example, remove the call "),s("code",[t._v("configure()")]),t._v(" in "),s("code",[t._v("app.py")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# myproject/app.py")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" bocadillo "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" App\n\napp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ...")]),t._v("\n")])])]),s("p",[t._v("and move it to a new "),s("code",[t._v("asgi.py")]),t._v(" script:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# myproject/asgi.py")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" bocadillo "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" configure\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" app\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" settings\n\nconfigure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" settings"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("You must now serve the app using "),s("code",[t._v("$ uvicorn myproject.asgi:app")]),t._v(" instead of "),s("code",[t._v("$ uvicorn myproject.app:app")]),t._v(".")])])},[],!1,null,null,null);e.default=n.exports}}]);