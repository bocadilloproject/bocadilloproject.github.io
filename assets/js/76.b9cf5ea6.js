(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{449:function(t,s,a){"use strict";a.r(s);var n=a(6),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"plugins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#plugins","aria-hidden":"true"}},[t._v("#")]),t._v(" Plugins")]),t._v(" "),a("Badge",{attrs:{type:"warn",text:"Experimental"}}),a("Badge",{attrs:{text:"0.14+"}}),t._v(" "),a("p",[a("strong",[t._v("Plugins")]),t._v(" allow to make small pieces of functionality "),a("strong",[t._v("configurable")]),t._v(" and "),a("strong",[t._v("reusable")]),t._v(" across applications and projects.")]),t._v(" "),a("p",[t._v("They solve two main use cases:")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("Improving project structure")]),t._v(": they can help declutter the "),a("code",[t._v("app.py")]),t._v(" script in case of complex configuration-based application initialisation.")]),t._v(" "),a("li",[a("strong",[t._v("Sharing reusable features")]),t._v(": bundle a plugin into a library or a package which other people can reuse.")])]),t._v(" "),a("h2",{attrs:{id:"writing-your-own-plugins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#writing-your-own-plugins","aria-hidden":"true"}},[t._v("#")]),t._v(" Writing your own plugins")]),t._v(" "),a("p",[t._v("Suppose we want to allow applications to perform a configurable action when the server starts up. As a contrived example, we will print a message to the console, but the action can be anything else.")]),t._v(" "),a("p",[t._v("Here's what a plugin for this feature would look like:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use_startup_message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    message "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" settings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"STARTUP_MESSAGE"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" message "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\n    @app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"startup"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on_startup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",[a("li",[t._v("We define a "),a("strong",[t._v("plugin function")]),t._v(" which accepts the "),a("code",[t._v("app")]),t._v(" as input. By convention, it should be named "),a("code",[t._v("use_X")]),t._v(", where "),a("code",[t._v("X")]),t._v(" describes the feature that the plugin implements.")]),t._v(" "),a("li",[t._v("Inside the plugin function, we access the "),a("code",[t._v("STARTUP_MESSAGE")]),t._v(" setting and, if it is defined, we register a lifespan event handler on the app.")])]),t._v(" "),a("h2",{attrs:{id:"where-should-plugins-be-located"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#where-should-plugins-be-located","aria-hidden":"true"}},[t._v("#")]),t._v(" Where should plugins be located?")]),t._v(" "),a("p",[t._v("If you intend to use it for your own project, consider putting it in a "),a("code",[t._v("plugins")]),t._v(" module, e.g. "),a("code",[t._v("myproject/plugins.py")]),t._v(".")]),t._v(" "),a("p",[t._v("If you're bundling the plugin into a package, you should also place it in a "),a("code",[t._v("plugins")]),t._v(" module, e.g. "),a("code",[t._v("my_third_party_lib/plugins.py")]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"using-plugins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-plugins","aria-hidden":"true"}},[t._v("#")]),t._v(" Using plugins")]),t._v(" "),a("p",[t._v("Once registered, a plugin is executed during the "),a("router-link",{attrs:{to:"/guide/config.html"}},[t._v("configuration")]),t._v(" phase, i.e. when calling "),a("code",[t._v("configure()")]),t._v(".")],1),t._v(" "),a("p",[t._v("To register plugins, use the "),a("code",[t._v("PLUGINS")]),t._v(" setting:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# myproject/settings.py")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" starlette"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Config\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" third_party_logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" use_startup_message\n\nconfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('".env"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nPLUGINS "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    use_startup_message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nSTARTUP_MESSAGE "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"STARTUP_MESSAGE"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"App is ready!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"conditional-plugin-registration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#conditional-plugin-registration","aria-hidden":"true"}},[t._v("#")]),t._v(" Conditional plugin registration")]),t._v(" "),a("p",[t._v("Instead of plugin functions, items in the list of "),a("code",[t._v("PLUGINS")]),t._v(" can be dictionaries that map plugins to boolean values indicating whether they should be registered or ignored.")]),t._v(" "),a("p",[t._v("This is a very powerful feature â€” for example, you can enable/disable features (or even entire sections of the app) based on environment variables:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# myproject/plugins.py")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use_auth_routes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    @app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/login"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("login")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# TODO")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/logout"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("logout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# TODO")]),t._v("\n")])])]),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# myproject/settings.py")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" starlette"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Config\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" third_party_logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" use_startup_message\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" myproject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" use_auth_routes\n\nconfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('".env"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nPLUGINS "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        use_startup_message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"VERBOSE"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        use_auth_routes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ENABLE_AUTH"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cast"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nSTARTUP_MESSAGE "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"App is ready!"')]),t._v("\n")])])]),a("h2",{attrs:{id:"built-in-plugins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#built-in-plugins","aria-hidden":"true"}},[t._v("#")]),t._v(" Built-in plugins")]),t._v(" "),a("p",[t._v("Every Bocadillo application comes with a pre-defined set of plugins which enable various features (CORS, HSTS, static files, etc.). Built-in plugins are listed in the "),a("router-link",{attrs:{to:"/api/plugins.html"}},[a("code",[t._v("plugins.py")])]),t._v(" API reference.")],1),t._v(" "),a("p",[t._v("Most built-in plugins are disabled by default. For this reason, we don't currently provide a way to unregister them.")])],1)},[],!1,null,null,null);s.default=e.exports}}]);