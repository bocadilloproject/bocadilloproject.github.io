(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{448:function(t,a,s){"use strict";s.r(a);var e=s(6),r=Object(e.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"requests"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#requests","aria-hidden":"true"}},[t._v("#")]),t._v(" Requests")]),t._v(" "),s("p",[s("router-link",{attrs:{to:"/api/request.html"}},[s("code",[t._v("Request")])]),t._v(" objects in Bocadillo expose the same interface as the\n"),s("a",{attrs:{href:"https://www.starlette.io/requests/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Starlette Request"),s("OutboundLink")],1),t._v(". Common usage is\ndocumented here.")],1),t._v(" "),s("h2",{attrs:{id:"method"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#method","aria-hidden":"true"}},[t._v("#")]),t._v(" Method")]),t._v(" "),s("p",[t._v("The HTTP method of the request is available at "),s("code",[t._v("req.method")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -X POST "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:8000"')]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 'POST'")]),t._v("\n")])])]),s("h2",{attrs:{id:"url"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#url","aria-hidden":"true"}},[t._v("#")]),t._v(" URL")]),t._v(" "),s("p",[t._v("The full URL of the request is available as "),s("code",[t._v("req.url")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:8000/foo/bar?add=sub"')]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# "http://localhost:8000/items?limit=10"')]),t._v("\n")])])]),s("p",[t._v("It is a string-like object that also exposes individual parts:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# "/items"')]),t._v("\nreq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("port  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 8000")]),t._v("\nreq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scheme  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# "http"')]),t._v("\nreq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# "127.0.0.1"')]),t._v("\nreq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# "limit=10"')]),t._v("\nreq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_secure  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# False")]),t._v("\n")])])]),s("h2",{attrs:{id:"headers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#headers","aria-hidden":"true"}},[t._v("#")]),t._v(" Headers")]),t._v(" "),s("p",[t._v("Request headers are available at "),s("code",[t._v("req.headers")]),t._v(", an immutable, case-insensitive\nPython dictionary.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -H "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-Framework: Bocadillo"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:8000"')]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'X-Framework'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# "Bocadillo"')]),t._v("\nreq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'x-framework'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# "Bocadillo"')]),t._v("\n")])])]),s("h2",{attrs:{id:"query-parameters"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#query-parameters","aria-hidden":"true"}},[t._v("#")]),t._v(" Query parameters")]),t._v(" "),s("p",[t._v("Query parameters are available at "),s("code",[t._v("req.query_params")]),t._v(", an immutable "),s("code",[t._v("MultiDict")]),t._v(", i.e. a dictionary-like object that supports having multiple elements per key.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:8000/items?limit=10&contain=foo&contain=bar"')]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query_params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"limit"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# "10"')]),t._v("\nreq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query_params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"notpresent"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# None")]),t._v("\nreq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query_params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"contains"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# "foo" (first item)')]),t._v("\nreq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query_params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getlist"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"contains"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# ["foo", "bar"]')]),t._v("\n")])])]),s("div",{staticClass:"tip custom-block"},[s("p",[t._v("Query parameters can be automatically injected based on view parameters. See "),s("router-link",{attrs:{to:"/guide/routing.html#query-parameters"}},[t._v("Routing")]),t._v(".")],1)]),t._v(" "),s("h2",{attrs:{id:"body"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#body","aria-hidden":"true"}},[t._v("#")]),t._v(" Body")]),t._v(" "),s("p",[t._v("In Bocadillo, "),s("strong",[t._v("the request body is an awaitable")]),t._v(". You can retrieve it in several ways, depending on the expected encoding:")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("Body type")]),t._v(" "),s("th",[t._v("Invocation")]),t._v(" "),s("th",[t._v("Return type")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("JSON")]),t._v(" "),s("td",[s("code",[t._v("await req.json()")])]),t._v(" "),s("td",[s("code",[t._v("list")]),t._v(" or "),s("code",[t._v("dict")])])]),t._v(" "),s("tr",[s("td",[t._v("Raw")]),t._v(" "),s("td",[s("code",[t._v("await req.body()")])]),t._v(" "),s("td",[s("code",[t._v("bytes")])])]),t._v(" "),s("tr",[s("td",[t._v("Form data*")]),t._v(" "),s("td",[s("code",[t._v("await req.form()")])]),t._v(" "),s("td",[s("code",[t._v("MultiDict")]),t._v("^")])])])]),t._v(" "),s("p",[t._v("Note:")]),t._v(" "),s("ul",[s("li",[t._v("It is safe to access the request body multiple times â€” it is cached on the first access.")]),t._v(" "),s("li",[t._v("If JSON is malformed, a "),s("code",[t._v("400 Bad Request")]),t._v(" error response is returned.")]),t._v(" "),s("li",[t._v("Form data contains both form data and multipart (upload) data.")]),t._v(" "),s("li",[s("code",[t._v("MultiDict")]),t._v(" is a dictionary-like object that behaves similarly to "),s("a",{attrs:{href:"#query-parameters"}},[s("code",[t._v("query_params")])]),t._v(".")])]),t._v(" "),s("h2",{attrs:{id:"streaming"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#streaming","aria-hidden":"true"}},[t._v("#")]),t._v(" Streaming")]),t._v(" "),s("p",[t._v("It is possible to process the request as a stream of "),s("strong",[t._v("bytes chunks")]),t._v(".")]),t._v(" "),s("p",[t._v("To do so, iterate (asynchronously) over the request object itself:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" chunk "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Process chunk")]),t._v("\n    text_chunk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" chunk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ...")]),t._v("\n")])])]),s("p",[t._v("This is useful when the request body may be too large to be loaded in full in memory, or to implement HTTP streaming, e.g. receiving and processing an unbounded stream of data during a single HTTP session.")]),t._v(" "),s("div",{staticClass:"warning custom-block"},[s("p",[t._v("The request's stream cannot be consumed more than once. If you try to do so, a "),s("code",[t._v("RuntimeError")]),t._v(" will be raised.")])])])},[],!1,null,null,null);a.default=r.exports}}]);