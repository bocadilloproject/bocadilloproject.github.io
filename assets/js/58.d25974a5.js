(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{465:function(t,a,e){"use strict";e.r(a);var s=e(6),r=Object(s.a)({},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"databases"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#databases","aria-hidden":"true"}},[t._v("#")]),t._v(" Databases")]),t._v(" "),e("p",[t._v("Storing data and/or retrieving it from a database is a very common task to perform in a server-side web application.")]),t._v(" "),e("p",[e("strong",[t._v("Bocadillo does not provide its "),e("em",[t._v("own")]),t._v(" database layer")]),t._v(", and probably never will. However, we do wish to integrate with a recommended solution in a foreseeable future.")]),t._v(" "),e("p",[t._v("In the meantime, you'll need to integrate with third-party libraries. While doing so, you'll definitely find "),e("router-link",{attrs:{to:"/guide/providers.html"}},[t._v("providers")]),t._v(" handy, as shown in this guide.")],1),t._v(" "),e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),e("p",[e("strong",[t._v("Querying a database is typically I/O-bound")]),t._v(" and can represent a significant part of the request processing time.")]),t._v(" "),e("p",[t._v("This makes "),e("strong",[t._v("asynchronous programming")]),t._v(" an ideal tool for the job, which is why this page only discusses "),e("strong",[t._v("async solutions")]),t._v(".")])]),t._v(" "),e("h2",{attrs:{id:"sql"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sql","aria-hidden":"true"}},[t._v("#")]),t._v(" SQL")]),t._v(" "),e("h3",{attrs:{id:"databases-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#databases-2","aria-hidden":"true"}},[t._v("#")]),t._v(" Databases")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/encode/databases",target:"_blank",rel:"noopener noreferrer"}},[t._v("Databases"),e("OutboundLink")],1),t._v(' is a library that "brings async database support to Python". It was built by Tom Christie, the developer behind the Django REST Framework, Starlette, uvicorn, as well as a number of exciting projects in the async Python world.')]),t._v(" "),e("p",[t._v("Here's an example setup that uses "),e("router-link",{attrs:{to:"/guide/providers.html"}},[t._v("providers")]),t._v(" to create the Database instance and inject it into web views:")],1),t._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# providerconf.py")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" bocadillo "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" provider\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" databases "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Database\n\n@provider"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("scope"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("db")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" Database"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postgresql://localhost/example"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" db"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" db\n")])])]),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app.py")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" bocadillo "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" App\n\napp "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" App"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n@app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" db"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# TODO: query the `db`! ✨")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),e("h3",{attrs:{id:"orm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#orm","aria-hidden":"true"}},[t._v("#")]),t._v(" ORM")]),t._v(" "),e("p",[t._v("Using an ORM (Object Relational Mapper) allows you to think in terms of classes and objects instead of tables and rows.")]),t._v(" "),e("p",[t._v("This technique has "),e("a",{attrs:{href:"https://www.fullstackpython.com/object-relational-mappers-orms.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("a number of benefits and drawbacks"),e("OutboundLink")],1),t._v(", but if you go for it the recommended option is "),e("a",{attrs:{href:"https://github.com/encode/orm",target:"_blank",rel:"noopener noreferrer"}},[t._v("orm"),e("OutboundLink")],1),t._v(", an asynchronous ORM for Python. It's based on SQLAlchemy Core, so it's fast, and easy to use, and supports all major databases (PostgreSQL, MySQL and SQLite). Besides, you can integrate it with Bocadillo to get "),e("strong",[t._v("data validation")]),t._v(" without any boilerplate — see: "),e("router-link",{attrs:{to:"/how-to/orm.html"}},[t._v("Use orm to interact with an SQL database")]),t._v(".")],1),t._v(" "),e("p",[t._v("For completeness, here are some alternatives to "),e("code",[t._v("orm")]),t._v(" we've come across:")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://tortoise-orm.readthedocs.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tortoise"),e("OutboundLink")],1),t._v(": an async ORM inspired by the Django ORM.")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/fantix/gino",target:"_blank",rel:"noopener noreferrer"}},[t._v("GINO"),e("OutboundLink")],1),t._v(": an async ORM based on SQLAlchemy Core.")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/05bit/peewee-async",target:"_blank",rel:"noopener noreferrer"}},[t._v("peewee-async"),e("OutboundLink")],1),t._v(": async wrapper around "),e("a",{attrs:{href:"https://github.com/coleifer/peewee",target:"_blank",rel:"noopener noreferrer"}},[t._v("peewee"),e("OutboundLink")],1),t._v(".")])]),t._v(" "),e("h3",{attrs:{id:"dialect-specific-client-library-advanced"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dialect-specific-client-library-advanced","aria-hidden":"true"}},[t._v("#")]),t._v(" Dialect-specific client library (advanced)")]),t._v(" "),e("p",[t._v("If your use case is very specific or low-level, you may want to resort to a dialect-specific async client library.")]),t._v(" "),e("p",[t._v("Here are some of the most popular ones:")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://www.github.com/MagicStack/asyncpg",target:"_blank",rel:"noopener noreferrer"}},[t._v("asyncpg"),e("OutboundLink")],1),t._v(" for PostgreSQL.")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/aio-libs/aiomysql",target:"_blank",rel:"noopener noreferrer"}},[t._v("aiomysql"),e("OutboundLink")],1),t._v(" for MySQL.")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/jreese/aiosqlite",target:"_blank",rel:"noopener noreferrer"}},[t._v("aiosqlite"),e("OutboundLink")],1),t._v(" for SQLite.")])]),t._v(" "),e("p",[t._v("Again, you'll definitely want to use "),e("router-link",{attrs:{to:"/guide/providers.html"}},[t._v("providers")]),t._v(" to setup and teardown database connections. Here's an example for asyncpg:")],1),t._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# providerconf.py")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" asyncpg\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" bocadillo "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" provider\n\n@provider"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("scope"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("conn")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    conn "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" asyncpg"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        user"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"secret"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" database"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"example"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" host"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" conn\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" conn"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h2",{attrs:{id:"nosql"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nosql","aria-hidden":"true"}},[t._v("#")]),t._v(" NoSQL")]),t._v(" "),e("p",[t._v("If you're using a NoSQL database, many high-quality async clients are already available.")]),t._v(" "),e("p",[t._v("Here are some popular ones:")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/mongodb/motor",target:"_blank",rel:"noopener noreferrer"}},[t._v("Motor"),e("OutboundLink")],1),t._v(" for MongoDB.")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/aio-libs/aioelasticsearch",target:"_blank",rel:"noopener noreferrer"}},[t._v("aioelasticsearch"),e("OutboundLink")],1),t._v(" for ElasticSearch.")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/aio-libs/aioredis",target:"_blank",rel:"noopener noreferrer"}},[t._v("aioredis"),e("OutboundLink")],1),t._v(" for Redis.")])]),t._v(" "),e("p",[t._v("You can find an example Redis setup "),e("router-link",{attrs:{to:"/guide/providers.html#problem-with-providers"}},[t._v("at the end of the providers problem statement")]),t._v(".")],1)])},[],!1,null,null,null);a.default=r.exports}}]);