(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{459:function(a,t,e){"use strict";e.r(t);var s=e(6),n=Object(s.a)({},function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"applications"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#applications","aria-hidden":"true"}},[a._v("#")]),a._v(" Applications")]),a._v(" "),e("p",[a._v("A Bocadillo application is an instance of "),e("router-link",{attrs:{to:"/api/applications.html#app"}},[e("code",[a._v("App")])]),a._v(". It implements the "),e("a",{attrs:{href:"https://asgi.readthedocs.io",target:"_blank",rel:"noopener noreferrer"}},[a._v("ASGI"),e("OutboundLink")],1),a._v(" interface and can be served by ASGI web servers.")],1),a._v(" "),e("h2",{attrs:{id:"minimal-working-application"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#minimal-working-application","aria-hidden":"true"}},[a._v("#")]),a._v(" Minimal working application")]),a._v(" "),e("p",[a._v("The following "),e("code",[a._v("app.py")]),a._v(" script defines a "),e("strong",[a._v("minimal working application")]),a._v(":")]),a._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" bocadillo "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" App"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" configure\n\napp "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" App"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\nconfigure"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),e("ol",[e("li",[a._v("First, we "),e("strong",[a._v("import")]),a._v(" the "),e("code",[a._v("App")]),a._v(" class and the "),e("code",[a._v("configure")]),a._v(" helper from the "),e("code",[a._v("bocadillo")]),a._v(" package.")]),a._v(" "),e("li",[a._v("Then, we "),e("strong",[a._v("instanciate")]),a._v(" an application.")]),a._v(" "),e("li",[a._v("Finally, the application is "),e("strong",[a._v("configured")]),a._v(" so that it can be served by an ASGI web server.")])]),a._v(" "),e("p",[a._v("Although this script could be served as-is, we recommend you adopt a "),e("strong",[a._v("package-style project structure")]),a._v(".")]),a._v(" "),e("p",[a._v("To do so, place the "),e("code",[a._v("app.py")]),a._v(" script in a folder containing an "),e("code",[a._v("__init__.py")]),a._v(" file:")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v(".\nâ””â”€â”€ myproject\n Â Â  â”œâ”€â”€ __init__.py\n Â Â  â””â”€â”€ app.py\n")])])]),e("p",[a._v("We'll assume that you use a package-style project structure in the rest of the documentation.")]),a._v(" "),e("h2",{attrs:{id:"serving-an-application"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#serving-an-application","aria-hidden":"true"}},[a._v("#")]),a._v(" Serving an application")]),a._v(" "),e("h3",{attrs:{id:"basics"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#basics","aria-hidden":"true"}},[a._v("#")]),a._v(" Basics")]),a._v(" "),e("p",[a._v("The officially recommended ASGI web server for Bocadillo is "),e("a",{attrs:{href:"https://www.uvicorn.org",target:"_blank",rel:"noopener noreferrer"}},[a._v("uvicorn"),e("OutboundLink")],1),a._v(". It comes installed with the "),e("code",[a._v("bocadillo")]),a._v(" package, so you can use it right away!")]),a._v(" "),e("p",[a._v("The minimal working app above can be served using:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("uvicorn myproject.app:app\n")])])]),e("h2",{attrs:{id:"configuring-uvicorn"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuring-uvicorn","aria-hidden":"true"}},[a._v("#")]),a._v(" Configuring uvicorn")]),a._v(" "),e("p",[a._v("You can use any of the "),e("a",{attrs:{href:"https://www.uvicorn.org/settings/",target:"_blank",rel:"noopener noreferrer"}},[a._v("uvicorn settings"),e("OutboundLink")],1),a._v(" to configure the server.")]),a._v(" "),e("p",[a._v("For example, you can tell uvicorn to use port 5000 using:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("uvicorn myproject.app:app --port 5000\n")])])]),e("h2",{attrs:{id:"hot-reload"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hot-reload","aria-hidden":"true"}},[a._v("#")]),a._v(" Hot reload")]),a._v(" "),e("p",[a._v("Hot reload is baked into uvicorn! ðŸš€ Use the uvicorn "),e("code",[a._v("--reload")]),a._v(" argument and uvicorn will watch your files and automatically reload the whole application on each file change! This is extremely useful in a development setting.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("uvicorn myproject.app:app --reload\n")])])]),e("h2",{attrs:{id:"lifespan-events"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lifespan-events","aria-hidden":"true"}},[a._v("#")]),a._v(" Lifespan events")]),a._v(" "),e("p",[a._v("Bocadillo applications implement the "),e("a",{attrs:{href:"https://asgi.readthedocs.io/en/latest/specs/lifespan.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("ASGI Lifespan protocol"),e("OutboundLink")],1),a._v(", which allows you to hook into the application's lifecycle via "),e("strong",[a._v("event handlers")]),a._v(".")]),a._v(" "),e("p",[a._v("This is especially useful to setup resources on startup and make sure they get cleaned up when the server stops.")]),a._v(" "),e("p",[a._v("An event handler is an asynchronous function with the signature "),e("code",[a._v("() -> None")]),a._v(".")]),a._v(" "),e("p",[a._v("Event handlers can be registered using the "),e("code",[a._v("@app.on()")]),a._v(" decorator:")]),a._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[a._v("@app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("on")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"startup"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("async")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("setup")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Perform setup when server boots")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("pass")]),a._v("\n\n@app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("on"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"shutdown"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("async")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cleanup")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Perform cleanup when server shuts down")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("pass")]),a._v("\n")])])]),e("p",[a._v("A non-decorator syntax is also available:")]),a._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" somelib "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" setup_stuff\n\napp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("on"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"startup"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" setup_stuff"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])])])},[],!1,null,null,null);t.default=n.exports}}]);