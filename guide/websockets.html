<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WebSockets | Bocadillo</title>
    <meta name="description" content="Fast, scalable and real-time capable web APIs for everyone: Bocadillo is a Python asynchronous web framework built with productivity and modularity in mind.">
    <link rel="stylesheet" href="/octicons.css">
  <link rel="shortcut icon" href="/favicon.ico?v=lk90Ny5lbz">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=lk90Ny5lbz">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=lk90Ny5lbz">
  <link rel="manifest" href="/site.webmanifest?v=lk90Ny5lbz">
  <meta name="theme-color" content="#ffe66b">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=lk90Ny5lbz">
  <link rel="mask-icon" href="/safari-pinned-tab.svg?v=lk90Ny5lbz" color="#91ba3f">
  <meta name="msapplication-TileColor" content="#ef9a4d">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://bocadilloproject.github.io">
  <meta name="twitter:title" content="Bocadillo">
  <meta name="twitter:site" content="@bocadillopy">
  <meta name="twitter:creator" content="Florimond Manca">
  <meta name="twitter:description" content="Fast, scalable and real-time capable web APIs for everyone: Bocadillo is a Python asynchronous web framework built with productivity and modularity in mind.">
  <meta name="twitter:image" content="https://bocadilloproject.github.io/logo.png">
  <meta name="google-site-verification" content="xbJzBKn7IuLWAUKvqHo1c3vMelw3eTRL0k3JcKjYB_k">
    
    <link rel="preload" href="/assets/css/0.styles.1610f5ec.css" as="style"><link rel="preload" href="/assets/js/app.ef5a74fe.js" as="script"><link rel="preload" href="/assets/js/2.741e5c13.js" as="script"><link rel="preload" href="/assets/js/22.60c6ec4e.js" as="script"><link rel="preload" href="/assets/js/90.7770f14c.js" as="script"><link rel="preload" href="/assets/js/23.fecdc752.js" as="script"><link rel="preload" href="/assets/js/32.43e6bd89.js" as="script"><link rel="prefetch" href="/assets/js/1.28623c5a.js"><link rel="prefetch" href="/assets/js/10.9e1006c4.js"><link rel="prefetch" href="/assets/js/100.764c96c8.js"><link rel="prefetch" href="/assets/js/101.79200541.js"><link rel="prefetch" href="/assets/js/102.2e1407e3.js"><link rel="prefetch" href="/assets/js/103.7830dd4a.js"><link rel="prefetch" href="/assets/js/104.52455b7e.js"><link rel="prefetch" href="/assets/js/105.fa552a9f.js"><link rel="prefetch" href="/assets/js/106.81313cd4.js"><link rel="prefetch" href="/assets/js/11.bdeaccad.js"><link rel="prefetch" href="/assets/js/12.fea470ff.js"><link rel="prefetch" href="/assets/js/13.39d7df02.js"><link rel="prefetch" href="/assets/js/14.c9927eee.js"><link rel="prefetch" href="/assets/js/15.87e26629.js"><link rel="prefetch" href="/assets/js/16.6281a5f1.js"><link rel="prefetch" href="/assets/js/17.3dc8666b.js"><link rel="prefetch" href="/assets/js/18.b93d182a.js"><link rel="prefetch" href="/assets/js/19.8093f59d.js"><link rel="prefetch" href="/assets/js/20.f6778ebc.js"><link rel="prefetch" href="/assets/js/21.83002d33.js"><link rel="prefetch" href="/assets/js/24.6ab6ed9a.js"><link rel="prefetch" href="/assets/js/25.3476451e.js"><link rel="prefetch" href="/assets/js/26.be460c24.js"><link rel="prefetch" href="/assets/js/27.78500487.js"><link rel="prefetch" href="/assets/js/28.df3b3176.js"><link rel="prefetch" href="/assets/js/29.171eca5b.js"><link rel="prefetch" href="/assets/js/30.27a29de9.js"><link rel="prefetch" href="/assets/js/31.c1e5ed6c.js"><link rel="prefetch" href="/assets/js/33.47234724.js"><link rel="prefetch" href="/assets/js/34.8f883d10.js"><link rel="prefetch" href="/assets/js/35.886bf2d6.js"><link rel="prefetch" href="/assets/js/36.d74a4b45.js"><link rel="prefetch" href="/assets/js/37.5f147823.js"><link rel="prefetch" href="/assets/js/38.6882e29b.js"><link rel="prefetch" href="/assets/js/39.b016911e.js"><link rel="prefetch" href="/assets/js/4.9e306066.js"><link rel="prefetch" href="/assets/js/40.2fc0e4ef.js"><link rel="prefetch" href="/assets/js/41.3f8233d4.js"><link rel="prefetch" href="/assets/js/42.bb51a16e.js"><link rel="prefetch" href="/assets/js/43.64c511ad.js"><link rel="prefetch" href="/assets/js/44.2fd79fd9.js"><link rel="prefetch" href="/assets/js/45.ef1889bb.js"><link rel="prefetch" href="/assets/js/46.faed4535.js"><link rel="prefetch" href="/assets/js/47.c5a1fd71.js"><link rel="prefetch" href="/assets/js/48.3f137c5f.js"><link rel="prefetch" href="/assets/js/49.107fe3f3.js"><link rel="prefetch" href="/assets/js/5.6d0d80f9.js"><link rel="prefetch" href="/assets/js/50.16babc94.js"><link rel="prefetch" href="/assets/js/51.a761ac95.js"><link rel="prefetch" href="/assets/js/52.b3da75d6.js"><link rel="prefetch" href="/assets/js/53.cb224ef5.js"><link rel="prefetch" href="/assets/js/54.5fd0de3b.js"><link rel="prefetch" href="/assets/js/55.c68c0838.js"><link rel="prefetch" href="/assets/js/56.b86c9cfc.js"><link rel="prefetch" href="/assets/js/57.9a875cd5.js"><link rel="prefetch" href="/assets/js/58.d25974a5.js"><link rel="prefetch" href="/assets/js/59.4229b9d5.js"><link rel="prefetch" href="/assets/js/6.9de27215.js"><link rel="prefetch" href="/assets/js/60.190f9994.js"><link rel="prefetch" href="/assets/js/61.a6787cb1.js"><link rel="prefetch" href="/assets/js/62.55269a82.js"><link rel="prefetch" href="/assets/js/63.d16c0a81.js"><link rel="prefetch" href="/assets/js/64.de71f4d5.js"><link rel="prefetch" href="/assets/js/65.ec533d3e.js"><link rel="prefetch" href="/assets/js/66.3ca3058a.js"><link rel="prefetch" href="/assets/js/67.8f39d473.js"><link rel="prefetch" href="/assets/js/68.5f1bfdf2.js"><link rel="prefetch" href="/assets/js/69.8a5ee484.js"><link rel="prefetch" href="/assets/js/7.baf0b149.js"><link rel="prefetch" href="/assets/js/70.cae2620c.js"><link rel="prefetch" href="/assets/js/71.88c976be.js"><link rel="prefetch" href="/assets/js/72.0608759c.js"><link rel="prefetch" href="/assets/js/73.30825c52.js"><link rel="prefetch" href="/assets/js/74.f3a4653a.js"><link rel="prefetch" href="/assets/js/75.f076bac4.js"><link rel="prefetch" href="/assets/js/76.b9cf5ea6.js"><link rel="prefetch" href="/assets/js/77.664fe172.js"><link rel="prefetch" href="/assets/js/78.bb705f3f.js"><link rel="prefetch" href="/assets/js/79.755a16c1.js"><link rel="prefetch" href="/assets/js/8.1430bdec.js"><link rel="prefetch" href="/assets/js/80.3b3c943c.js"><link rel="prefetch" href="/assets/js/81.8dfcf1f4.js"><link rel="prefetch" href="/assets/js/82.e0d8b8bf.js"><link rel="prefetch" href="/assets/js/83.8e788d4e.js"><link rel="prefetch" href="/assets/js/84.e62a4140.js"><link rel="prefetch" href="/assets/js/85.7de9077f.js"><link rel="prefetch" href="/assets/js/86.36b0b794.js"><link rel="prefetch" href="/assets/js/87.88eaed47.js"><link rel="prefetch" href="/assets/js/88.12e8bfee.js"><link rel="prefetch" href="/assets/js/89.79671657.js"><link rel="prefetch" href="/assets/js/9.fff42a24.js"><link rel="prefetch" href="/assets/js/91.34595596.js"><link rel="prefetch" href="/assets/js/92.d0e2a53f.js"><link rel="prefetch" href="/assets/js/93.0dd1d80f.js"><link rel="prefetch" href="/assets/js/94.224315b4.js"><link rel="prefetch" href="/assets/js/95.6a720b9e.js"><link rel="prefetch" href="/assets/js/96.f8e2cc61.js"><link rel="prefetch" href="/assets/js/97.6ace73bc.js"><link rel="prefetch" href="/assets/js/98.3851eb39.js"><link rel="prefetch" href="/assets/js/99.4f065790.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1610f5ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Bocadillo</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="/how-to/" class="nav-link">How-To</a></div><div class="nav-item"><a href="/discussions/" class="nav-link">Discussions</a></div><div class="nav-item"><a href="/api/" class="nav-link">Reference</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Ecosystem</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Tooling</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/bocadilloproject/bocadillo-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bocadillo CLI
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>Help</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/faq.html" class="nav-link">FAQ</a></li><li class="dropdown-subitem"><a href="/troubleshooting.html" class="nav-link">Troubleshooting</a></li></ul></li><li class="dropdown-item"><h4>News</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://twitter.com/bocadillopy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="/news/" class="nav-link">News</a></li><li class="dropdown-subitem"><a href="/mentions.html" class="nav-link">Mentions</a></li></ul></li><li class="dropdown-item"><h4>Resources</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/bocadilloproject/bocadillo/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://pypi.org/project/bocadillo/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PyPI
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://github.com/bocadilloproject" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Official repos
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div> <a href="https://github.com/bocadilloproject/bocadillo" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="/how-to/" class="nav-link">How-To</a></div><div class="nav-item"><a href="/discussions/" class="nav-link">Discussions</a></div><div class="nav-item"><a href="/api/" class="nav-link">Reference</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Ecosystem</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Tooling</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/bocadilloproject/bocadillo-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bocadillo CLI
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>Help</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/faq.html" class="nav-link">FAQ</a></li><li class="dropdown-subitem"><a href="/troubleshooting.html" class="nav-link">Troubleshooting</a></li></ul></li><li class="dropdown-item"><h4>News</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://twitter.com/bocadillopy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="/news/" class="nav-link">News</a></li><li class="dropdown-subitem"><a href="/mentions.html" class="nav-link">Mentions</a></li></ul></li><li class="dropdown-item"><h4>Resources</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/bocadilloproject/bocadillo/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://pypi.org/project/bocadillo/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PyPI
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://github.com/bocadilloproject" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Official repos
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div> <a href="https://github.com/bocadilloproject/bocadillo" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/guide/" class="sidebar-link">Introduction</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Essentials</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Built-in features</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Real-Time Web</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/websockets.html" class="active sidebar-link">WebSockets</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/websockets.html#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/guide/websockets.html#hello-websockets" class="sidebar-link">Hello, WebSockets!</a></li><li class="sidebar-sub-header"><a href="/guide/websockets.html#how-are-websocket-requests-processed" class="sidebar-link">How are WebSocket requests processed?</a></li><li class="sidebar-sub-header"><a href="/guide/websockets.html#websocket-views" class="sidebar-link">WebSocket views</a></li><li class="sidebar-sub-header"><a href="/guide/websockets.html#inspecting-the-connection-request" class="sidebar-link">Inspecting the connection request</a></li><li class="sidebar-sub-header"><a href="/guide/websockets.html#receiving-messages" class="sidebar-link">Receiving messages</a></li><li class="sidebar-sub-header"><a href="/guide/websockets.html#sending-messages" class="sidebar-link">Sending messages</a></li><li class="sidebar-sub-header"><a href="/guide/websockets.html#using-asgi-events" class="sidebar-link">Using ASGI events</a></li><li class="sidebar-sub-header"><a href="/guide/websockets.html#error-handling" class="sidebar-link">Error handling</a></li><li class="sidebar-sub-header"><a href="/guide/websockets.html#accepting-closing-and-rejecting-connections" class="sidebar-link">Accepting, closing and rejecting connections</a></li><li class="sidebar-sub-header"><a href="/guide/websockets.html#returning-errors" class="sidebar-link">Returning errors</a></li><li class="sidebar-sub-header"><a href="/guide/websockets.html#client-side-connection-closures" class="sidebar-link">Client-side connection closures</a></li><li class="sidebar-sub-header"><a href="/guide/websockets.html#example-real-time-chat-room" class="sidebar-link">Example: real-time chat room</a></li></ul></li><li><a href="/guide/sse.html" class="sidebar-link">Server-Sent Events</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reusability &amp; Modularity</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tooling</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="content deprecation-warning" style="margin:1rem;margin-top:4.6rem;" data-v-b1b05e82><p data-v-b1b05e82><strong data-v-b1b05e82>Warning:</strong> Bocadillo is now <strong data-v-b1b05e82>UNMAINTAINED</strong>.
    Users are recommended to migrate to a supported alternative, such as
    <a href="https://www.starlette.io" target="_blank" rel="noreferrer" data-v-b1b05e82>Starlette</a>
    or
    <a href="https://fastapi.tiangolo.com" target="_blank" rel="noreferrer" data-v-b1b05e82>FastAPI</a>. Please see
    <a href="https://github.com/bocadilloproject/bocadillo/issues/334" target="_blank" rel="noreferrer" data-v-b1b05e82>#344</a>
    for more information.
  </p></div> <div class="theme-default-content content__default"><h1 id="websockets"><a href="#websockets" aria-hidden="true" class="header-anchor">#</a> WebSockets</h1> <p><strong>WebSockets</strong> allow a web browser and a web server to communicate in a bi-directional way via a long-held, low-latency TCP socket connection. WebSockets are <a href="https://caniuse.com/#feat=websockets" target="_blank" rel="noopener noreferrer">broadly supported<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, and can be used to build <strong>event-driven</strong> and <strong>real-time</strong> features such as notifications, instant messaging, etc.</p> <p>Bocadillo makes it easy to build WebSocket apps that deal with hundreds or thousands of concurrent connections in real-time.</p> <div align="center"><img src="/websocket.png" alt="WebSocket enables real-time, bidirectional communication between servers and clients."> <figcaption style="font-style: italic;">WebSocket enables real-time, bidirectional communication between servers and clients.</figcaption></div> <div class="tip custom-block"><p class="custom-block-title">ALTERNATIVE</p> <p>You can also use the higher-level <a href="https://socket.io" target="_blank" rel="noopener noreferrer">socket.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> framework in Bocadillo applications. See also <a href="/how-to/socketio.html">Build a real-time application with socket.io</a>.</p></div> <h2 id="prerequisites"><a href="#prerequisites" aria-hidden="true" class="header-anchor">#</a> Prerequisites</h2> <p>Bocadillo comes with the <a href="https://websockets.readthedocs.io" target="_blank" rel="noopener noreferrer">websockets<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> package installed, so you do not need to install extra dependencies. You're ready to go!</p> <div class="tip custom-block"><p>If you need an introduction to WebSockets, we recommend Dion Misic's talk <a href="https://www.youtube.com/watch?v=PjiXkJ6P9pQ" target="_blank" rel="noopener noreferrer">A Beginner's Guide to WebSockets<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (Pycon 2018).</p></div> <h2 id="hello-websockets"><a href="#hello-websockets" aria-hidden="true" class="header-anchor">#</a> Hello, WebSockets!</h2> <p>Let's learn by example! Here's how simple it is to create an echo WebSocket endpoint:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>websocket_route</span><span class="token punctuation">(</span><span class="token string">&quot;/echo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">echo</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span><span class="token punctuation">:</span>
    message <span class="token operator">=</span> <span class="token keyword">await</span> ws<span class="token punctuation">.</span>receive<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> ws<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;You said: </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</code></pre></div><p>Just four lines of code!</p> <p>Note that:</p> <ul><li>The route is registered using <a href="/api/routing.html#websocket-route"><code>@app.websocket_route()</code></a> instead of <code>@app.route()</code>.</li> <li>If no message is available yet when calling <code>.receive()</code>, the view will suspend, allowing the server to process other requests until a message is received.</li></ul> <p>A vanilla JavaScript client for the endpoint above could be:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws://localhost:8000/echo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected:&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connection lost:&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received:&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token punctuation">{</span> text<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span> <span class="token operator">?</span> <span class="token string">&quot;ping&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;pong&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Sent: &quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="how-are-websocket-requests-processed"><a href="#how-are-websocket-requests-processed" aria-hidden="true" class="header-anchor">#</a> How are WebSocket requests processed?</h2> <p>When a client makes a request to your server with the <code>ws://</code> or <code>wss://</code> scheme, the following happens:</p> <ol><li>The client and the ASGI web server perform a handshake to agree to <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Protocol_upgrade_mechanism" target="_blank" rel="noopener noreferrer">upgrade the protocol<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to WebSocket. This is not handled by Bocadillo directly.</li> <li>The upgraded request is routed to Bocadillo and a <a href="/api/websockets.html#websocket"><code>WebSocket</code></a> object is created out of it.</li> <li>Bocadillo tries to match the requested URL path against a registered WebSocket route. If none is found, the connection is closed with a 403 close code.</li> <li>Bocadillo calls the view attached to the route that matched. It must be an asynchronous function accepting the following parameters:
<ul><li>An instance of <a href="/api/websockets.html#websocket"><code>WebSocket</code></a>.</li> <li>Keyword arguments representing the extracted route and query parameters.</li></ul></li> <li>If an exception is raised in the process, the connection is closed by following the procedure described in <a href="#error-handling">Error handling</a>.</li></ol> <h2 id="websocket-views"><a href="#websocket-views" aria-hidden="true" class="header-anchor">#</a> WebSocket views</h2> <p>A WebSocket route maps an URL pattern to a WebSocket <strong>view</strong>. It is an <strong>asynchronous function</strong> which takes as input the <a href="/api/websockets.html#websocket"><code>WebSocket</code></a> object (named <code>ws</code> by convention) and keyword arguments obtained from route and query parameters.</p> <p>Besides the modified signature, you can use <a href="/guide/routing.html#router-parameters">route parameters</a> and <a href="/guide/routing.html#query-parameters">query parameters</a> as well as <a href="/guide/routing.html#validation-and-conversion">validation and conversion</a> just like in HTTP endpoints:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>websocket_route</span><span class="token punctuation">(</span><span class="token string">&quot;/chat/{channel}&quot;</span><span class="token punctuation">,</span> value_type<span class="token operator">=</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">chat</span><span class="token punctuation">(</span>ws<span class="token punctuation">,</span> channel<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> anonymous<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> <span class="token string">&quot;Anonymous&quot;</span> <span class="token keyword">if</span> anonymous <span class="token keyword">else</span> ws<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">]</span>
    <span class="token keyword">async</span> <span class="token keyword">for</span> message <span class="token keyword">in</span> ws<span class="token punctuation">:</span>
        channel_message <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span> user<span class="token punctuation">,</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span> message<span class="token punctuation">}</span>
        <span class="token comment"># TODO: send `channel_message` to other clients in the channel…</span>
        <span class="token keyword">await</span> ws<span class="token punctuation">.</span>send<span class="token punctuation">(</span>channel_message<span class="token punctuation">)</span>
</code></pre></div><h2 id="inspecting-the-connection-request"><a href="#inspecting-the-connection-request" aria-hidden="true" class="header-anchor">#</a> Inspecting the connection request</h2> <p>The <a href="/api/websockets.html#websocket"><code>WebSocket</code></a> object exposes some of the attributes available on <code>Request</code> objects, namely:</p> <ul><li><code>.url</code>: the full URL of the connection request.</li> <li><code>.headers</code>: an immutable, case-insensitive Python dictionary containing HTTP headers.</li> <li><code>.query_parameters</code>: an immutable Python dictionary-like object containing query parameters.</li></ul> <p>Please see the documentation on <a href="/guide/requests.html">Requests</a> for more information on these attributes.</p> <p>When <a href="/guide/sessions.html">sessions</a> are enabled, you can also access session data through <code>ws.session</code>.</p> <h2 id="receiving-messages"><a href="#receiving-messages" aria-hidden="true" class="header-anchor">#</a> Receiving messages</h2> <p>You can receive messages from the WebSocket connection using <code>ws.receive()</code>:</p> <div class="language-python extra-class"><pre class="language-python"><code>message <span class="token operator">=</span> <span class="token keyword">await</span> ws<span class="token punctuation">.</span>receive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>By default, the message is returned in plain text. You can customize this by specifying a <code>receive_type</code>:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>websocket_route</span><span class="token punctuation">(</span><span class="token string">&quot;/chat&quot;</span><span class="token punctuation">,</span> receive_type<span class="token operator">=</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>The possible values for <code>receive_type</code> are: <code>json</code>, <code>text</code>, and <code>bytes</code>.</p> <p>For convenience, the corresponding methods are available on <code>ws</code>: <code>.receive_json()</code>, <code>.receive_text()</code>, and <code>.receive_bytes()</code>.</p> <p>If you plan to receive a potentially infinite number of messages, you can use the <code>async for</code> syntax to <strong>iterate over messages</strong>:</p> <div class="language-python extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br></div><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>websocket_route</span><span class="token punctuation">(</span><span class="token string">&quot;/echo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">echo</span><span class="token punctuation">(</span>ws<span class="token punctuation">:</span> WebSocket<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">for</span> message <span class="token keyword">in</span> ws<span class="token punctuation">:</span>
        <span class="token comment"># ...</span>
</code></pre></div><p>This is simply a shorthand for:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>websocket_route</span><span class="token punctuation">(</span><span class="token string">&quot;/echo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">echo</span><span class="token punctuation">(</span>ws<span class="token punctuation">:</span> WebSocket<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        message <span class="token operator">=</span> <span class="token keyword">await</span> ws<span class="token punctuation">.</span>receive<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># ...</span>
</code></pre></div><h2 id="sending-messages"><a href="#sending-messages" aria-hidden="true" class="header-anchor">#</a> Sending messages</h2> <p>To send messages over the WebSocket, use the <code>.send()</code> method:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">await</span> ws<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">&quot;Hello, WebSockets!&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>By default, the message is sent in plain text. You can customize this by specifying a <code>send_type</code>:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>websocket_route</span><span class="token punctuation">(</span><span class="token string">&quot;/chat&quot;</span><span class="token punctuation">,</span> send_type<span class="token operator">=</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>The possible values for <code>send_type</code> are: <code>json</code>, <code>text</code>, and <code>bytes</code>.</p> <p>For convenience, the corresponding methods are available on <code>ws</code>: <code>.send_json()</code>, <code>.send_text()</code>, and <code>.send_bytes()</code>.</p> <div class="tip custom-block"><p>To receive and send messages of the same type, use <code>value_type</code>:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>websocket_route</span><span class="token punctuation">(</span><span class="token string">&quot;/chat&quot;</span><span class="token punctuation">,</span> value_type<span class="token operator">=</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>This is equivalent to:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>websocket_route</span><span class="token punctuation">(</span><span class="token string">&quot;/chat&quot;</span><span class="token punctuation">,</span> receive_type<span class="token operator">=</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> send_type<span class="token operator">=</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>Obviously, the <code>value_type</code> must be a valid receive and send type.</p></div> <h2 id="using-asgi-events"><a href="#using-asgi-events" aria-hidden="true" class="header-anchor">#</a> Using ASGI events <span class="badge warn" style="vertical-align:top;" data-v-c13ee5b0>Advanced</span></h2> <p>It is also possible to receive or send raw <a href="https://asgi.readthedocs.io/en/latest/specs/main.html#events" target="_blank" rel="noopener noreferrer">ASGI events<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> using the low-level <code>.receive_event()</code> and <code>.send_event()</code> methods.</p> <p>For example, here's an implemention of an echo endpoint using ASGI events only:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>websocket_route</span><span class="token punctuation">(</span><span class="token string">&quot;/echo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">echo</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span><span class="token punctuation">:</span>
    event <span class="token operator">=</span> <span class="token keyword">await</span> ws<span class="token punctuation">.</span>receive_event<span class="token punctuation">(</span><span class="token punctuation">)</span>
    message <span class="token operator">=</span> event<span class="token punctuation">[</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">]</span>
    <span class="token keyword">await</span> ws<span class="token punctuation">.</span>send_event<span class="token punctuation">(</span>
        <span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;websocket.send&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f&quot;You said: </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
</code></pre></div><h2 id="error-handling"><a href="#error-handling" aria-hidden="true" class="header-anchor">#</a> Error handling</h2> <p>Contrary to HTTP routes, Bocadillo does not provide error handling for WebSocket routes.</p> <p>If an unhandled exception occurs, Bocadillo closes the connection with a 1011 (Internal Error) close code and re-raises the exception for further server-side processing.</p> <h2 id="accepting-closing-and-rejecting-connections"><a href="#accepting-closing-and-rejecting-connections" aria-hidden="true" class="header-anchor">#</a> Accepting, closing and rejecting connections <span class="badge warn" style="vertical-align:top;" data-v-c13ee5b0>Advanced</span></h2> <p>In the standard WebSocket protocol, the server must <strong>accept</strong> a connection request when it receives one from a client, and <strong>close</strong> it when the communication ends.</p> <p>By default, <strong>Bocadillo automatically accepts and closes the connection</strong>, respectively before and after calling the view. This reduces boilerplate and allows you to focus on receiving and sending messages.</p> <p>For advanced use cases, you can disable this behavior by passing <code>auto_accept=False</code> to <code>@app.websocket_route()</code>. You then need to call <code>.accept()</code> and <code>.close()</code> manually:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>websocket_route</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span> auto_accept<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Going to accept connection…&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> ws<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">await</span> ws<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Connection closed!&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>For convenience, an <a href="https://www.python.org/dev/peps/pep-0492/#asynchronous-context-managers-and-async-with" target="_blank" rel="noopener noreferrer">asynchronous context manager<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> syntax is also available:</p> <div class="language-python extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>websocket_route</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span> auto_accept<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Going to accept connection…&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> ws<span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Connection closed normally!&quot;</span><span class="token punctuation">)</span>
</code></pre></div><div class="tip custom-block"><p>It is safe to call <code>.close()</code> inside the <code>async with</code> block. However, calling it multiple times will raise a <code>RuntimeError</code>.</p> <p>When you're not sure whether the connection has already been closed, use <code>await ws.ensure_closed()</code> instead.</p></div> <p>It is possible to <strong>reject</strong> a WebSocket connection request by calling <code>.reject()</code>. This results in closing the connection with a 403 close code, and must be done <em>before</em> calling <code>.accept()</code>. This is useful to implement <strong>permission checks</strong>. For example, here's an endpoint protected by a very naive API key check:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>websocket_route</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> ws<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;api-key&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">&quot;s3kr3t&quot;</span><span class="token punctuation">:</span>
        <span class="token keyword">await</span> ws<span class="token punctuation">.</span>reject<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> ws<span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token comment"># Proceed with an authorized client</span>
</code></pre></div><h2 id="returning-errors"><a href="#returning-errors" aria-hidden="true" class="header-anchor">#</a> Returning errors <span class="badge warn" style="vertical-align:top;" data-v-c13ee5b0>Advanced</span></h2> <p>Notifying clients of errors can be done by closing the connection and providing a <strong>close code</strong>:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">await</span> ws<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token number">1003</span><span class="token punctuation">)</span>
</code></pre></div><p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent" target="_blank" rel="noopener noreferrer">CloseEvent<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> API reference lists WebSocket close codes and their meaning. In particular:</p> <ul><li>Standard codes in the <strong>1000-1015 range</strong> may be useful, and are available as constants in <a href="https://github.com/encode/starlette/blob/master/starlette/status.py" target="_blank" rel="noopener noreferrer">Starlette's <code>status</code> module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li> <li>The <strong>4000-4999 range</strong> should be used for application-specific errors.</li></ul> <p>For example:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> random
<span class="token keyword">from</span> starlette <span class="token keyword">import</span> status

BOOM <span class="token operator">=</span> <span class="token number">4003</span>

@app<span class="token punctuation">.</span>websocket_route<span class="token punctuation">(</span><span class="token string">&quot;/dangerous&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">dangerous</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        message <span class="token operator">=</span> <span class="token keyword">await</span> ws<span class="token punctuation">.</span>message<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.1</span><span class="token punctuation">:</span>
            <span class="token keyword">await</span> ws<span class="token punctuation">.</span>close<span class="token punctuation">(</span>BOOM<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token keyword">await</span> ws<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">&quot;OK&quot;</span><span class="token punctuation">)</span>

    <span class="token comment"># Bocadillo does this automatically, but we can</span>
    <span class="token comment"># close the connection ourself if we need to.</span>
    <span class="token keyword">await</span> ws<span class="token punctuation">.</span>close<span class="token punctuation">(</span>status<span class="token punctuation">.</span>WS_1000_NORMAL_CLOSURE<span class="token punctuation">)</span>
</code></pre></div><h2 id="client-side-connection-closures"><a href="#client-side-connection-closures" aria-hidden="true" class="header-anchor">#</a> Client-side connection closures <span class="badge warn" style="vertical-align:top;" data-v-c13ee5b0>Advanced</span></h2> <p>When the client disconnects while we are trying to <code>.receive()</code> a message, a <code>WebSocketDisconnect</code> exception is raised.</p> <p>This exception is automatically caught (and silenced) if:</p> <ul><li><code>auto_accept=True</code> (the default) or we are inside an <code>async with ws:</code> block.</li> <li>The close code sent by the client is 1000 (Normal Closure) or 1001 (Going Away), both being considered successful close codes.</li></ul> <p>In other cases, you will need to handle the exception yourself. For example, some web browsers may send a 1006 (Abnormal Closure) close code when a user closes a page while the WebSocket connection is open.</p> <p>If you want to add this code (or any other code) to those automatically caught by Bocadillo, use <code>caught_close_codes</code>:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>websocket_route</span><span class="token punctuation">(</span><span class="token string">&quot;/chat&quot;</span><span class="token punctuation">,</span> caught_close_codes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1001</span><span class="token punctuation">,</span> <span class="token number">1006</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>You can also pass <code>all</code> (the built-in) to catch all close codes. To not catch any close code, pass the empty tuple <code>()</code>.</p> <h2 id="example-real-time-chat-room"><a href="#example-real-time-chat-room" aria-hidden="true" class="header-anchor">#</a> Example: real-time chat room</h2> <p>To wrap things up, here is the code for a rudimentary chat room application built with Bocadillo WebSockets. The UI is provided via an HTML template, and this app uses <a href="/guide/providers.html">providers</a> to keep track of clients and store the history of messages.</p> <p>You can find the code on <a href="https://github.com/bocadilloproject/bocadillo/path/master/docs/guide/snippets/websocket-example" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="usage"><a href="#usage" aria-hidden="true" class="header-anchor">#</a> Usage</h3> <ul><li>Start the server: <code>uvicorn app:app</code>.</li> <li>Open a web browser at <a href="http://localhost:8000" target="_blank" rel="noopener noreferrer">http://localhost:8000<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li> <li>Start chatting!</li></ul> <h3 id="application-script"><a href="#application-script" aria-hidden="true" class="header-anchor">#</a> Application script</h3> <div class="language- extra-class"><pre class="language-text"><code>Not found: /home/travis/build/bocadilloproject/bocadillo/docs/guide/snippets/websocket-example/app.py</code></pre></div><h3 id="html-template"><a href="#html-template" aria-hidden="true" class="header-anchor">#</a> HTML template</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- templates/index.html --&gt;</span>
<span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Chat room<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Chat room<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- Messages are injected in here --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>messages<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Username<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Enter a message…<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Send<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws://localhost:8000/chat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> textEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> userEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> messagesEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;messages&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;submit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Prevent page reload as form is submitted.</span>
        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Do not send blank messages.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>textEl<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Create and send the JSON message.</span>
        <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token punctuation">{</span>
            type<span class="token punctuation">:</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span>
            user<span class="token punctuation">:</span> userEl<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
            text<span class="token punctuation">:</span> textEl<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Reset text input.</span>
        textEl<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span>
                <span class="token comment">// Append a new element to the list of messages.</span>
                <span class="token keyword">const</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                li<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token punctuation">.</span>user<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token punctuation">.</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
                messagesEl<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token punctuation">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Unknown message type: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Closed&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/bocadilloproject/bocadillo/edit/release/docs/docs/guide/websockets.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">5/22/2019, 7:47:24 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/guide/background-tasks.html" class="prev">
          Background tasks
        </a></span> <span class="next"><a href="/guide/sse.html">
          Server-Sent Events
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ef5a74fe.js" defer></script><script src="/assets/js/2.741e5c13.js" defer></script><script src="/assets/js/22.60c6ec4e.js" defer></script><script src="/assets/js/90.7770f14c.js" defer></script><script src="/assets/js/23.fecdc752.js" defer></script><script src="/assets/js/32.43e6bd89.js" defer></script>
  </body>
</html>
